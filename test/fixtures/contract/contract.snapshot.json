{
  "name": "zcl",
  "version": "0.0.0-dev",
  "artifactLayoutVersion": 1,
  "traceSchemaVersion": 1,
  "artifacts": [
    {
      "id": "run.json",
      "kind": "json",
      "schemaVersions": [
        1
      ],
      "required": true,
      "pathPattern": ".zcl/runs/<runId>/run.json",
      "requiredFields": [
        "schemaVersion",
        "runId",
        "suiteId",
        "createdAt"
      ]
    },
    {
      "id": "suite.json",
      "kind": "json",
      "schemaVersions": [
        1
      ],
      "required": false,
      "pathPattern": ".zcl/runs/<runId>/suite.json",
      "requiredFields": []
    },
    {
      "id": "attempt.json",
      "kind": "json",
      "schemaVersions": [
        1
      ],
      "required": true,
      "pathPattern": ".zcl/runs/<runId>/attempts/<attemptId>/attempt.json",
      "requiredFields": [
        "schemaVersion",
        "runId",
        "suiteId",
        "missionId",
        "attemptId",
        "mode",
        "startedAt"
      ]
    },
    {
      "id": "prompt.txt",
      "kind": "text",
      "schemaVersions": [
        1
      ],
      "required": false,
      "pathPattern": ".zcl/runs/<runId>/attempts/<attemptId>/prompt.txt",
      "requiredFields": []
    },
    {
      "id": "feedback.json",
      "kind": "json",
      "schemaVersions": [
        1
      ],
      "required": true,
      "pathPattern": ".zcl/runs/<runId>/attempts/<attemptId>/feedback.json",
      "requiredFields": [
        "schemaVersion",
        "runId",
        "suiteId",
        "missionId",
        "attemptId",
        "ok",
        "createdAt"
      ]
    },
    {
      "id": "attempt.report.json",
      "kind": "json",
      "schemaVersions": [
        1
      ],
      "required": false,
      "pathPattern": ".zcl/runs/<runId>/attempts/<attemptId>/attempt.report.json",
      "requiredFields": [
        "schemaVersion",
        "runId",
        "suiteId",
        "missionId",
        "attemptId",
        "computedAt",
        "metrics"
      ]
    },
    {
      "id": "runner.ref.json",
      "kind": "json",
      "schemaVersions": [
        1
      ],
      "required": false,
      "pathPattern": ".zcl/runs/<runId>/attempts/<attemptId>/runner.ref.json",
      "requiredFields": [
        "schemaVersion",
        "runner",
        "runId",
        "suiteId",
        "missionId",
        "attemptId"
      ]
    },
    {
      "id": "runner.metrics.json",
      "kind": "json",
      "schemaVersions": [
        1
      ],
      "required": false,
      "pathPattern": ".zcl/runs/<runId>/attempts/<attemptId>/runner.metrics.json",
      "requiredFields": [
        "schemaVersion",
        "runner"
      ]
    }
  ],
  "events": [
    {
      "stream": "tool.calls.jsonl",
      "schemaVersions": [
        1
      ],
      "requiredFields": [
        "v",
        "ts",
        "runId",
        "missionId",
        "attemptId",
        "tool",
        "op",
        "result",
        "io"
      ]
    },
    {
      "stream": "notes.jsonl",
      "schemaVersions": [
        1
      ],
      "requiredFields": [
        "v",
        "ts",
        "runId",
        "missionId",
        "attemptId",
        "kind"
      ]
    }
  ],
  "commands": [
    {
      "id": "init",
      "usage": "zcl init [--out-root .zcl] [--config zcl.config.json] [--json]",
      "summary": "Initialize the project output root and write the minimal project config."
    },
    {
      "id": "feedback",
      "usage": "zcl feedback --ok|--fail --result <string>|--result-json <json>",
      "summary": "Write the canonical attempt outcome to feedback.json (primary evidence)."
    },
    {
      "id": "note",
      "usage": "zcl note [--kind agent|operator|system] --message <string>|--data-json <json>",
      "summary": "Append a bounded/redacted note event to notes.jsonl (secondary evidence)."
    },
    {
      "id": "report",
      "usage": "zcl report [--strict] [--json] <attemptDir|runDir>",
      "summary": "Compute attempt.report.json from tool.calls.jsonl + feedback.json."
    },
    {
      "id": "validate",
      "usage": "zcl validate [--strict] [--json] <attemptDir|runDir>",
      "summary": "Validate artifact integrity (schemas, ids, bounds, containment) with typed error codes."
    },
    {
      "id": "doctor",
      "usage": "zcl doctor [--out-root .zcl] [--json]",
      "summary": "Check environment/config sanity (write access, config parse, optional runner availability)."
    },
    {
      "id": "gc",
      "usage": "zcl gc [--out-root .zcl] [--max-age-days 30] [--max-total-bytes 0] [--dry-run] [--json]",
      "summary": "Retention cleanup under .zcl/runs (age/size; respects pinned runs)."
    },
    {
      "id": "enrich",
      "usage": "zcl enrich --runner codex --rollout <rollout.jsonl> [<attemptDir>]",
      "summary": "Optional runner enrichment (writes runner.ref.json + runner.metrics.json)."
    },
    {
      "id": "mcp proxy",
      "usage": "zcl mcp proxy -- <server-cmd> [args...]",
      "summary": "MCP stdio proxy funnel (records initialize/tools/list/tools/call)."
    },
    {
      "id": "run",
      "usage": "zcl run -- <cmd> [args...]",
      "summary": "Run a command through the ZCL CLI funnel (passthrough stdout/stderr, bounded capture for traces)."
    },
    {
      "id": "contract",
      "usage": "zcl contract --json",
      "summary": "Print the ZCL surface contract (artifact layout + supported schema versions)."
    },
    {
      "id": "attempt start",
      "usage": "zcl attempt start --suite <suiteId> --mission <missionId> [--prompt <text>] [--suite-file <path>] [--run-id <runId>] [--agent-id <id>] [--mode discovery|ci] [--out-root .zcl] [--retry 1] --json",
      "summary": "Allocate a run/attempt directory and print canonical IDs + env for the spawned agent."
    },
    {
      "id": "suite plan",
      "usage": "zcl suite plan --file <suite.(yaml|yml|json)> [--run-id <runId>] [--mode discovery|ci] [--out-root .zcl] --json",
      "summary": "Allocate attempt dirs for every mission in a suite file and print env/pointers per mission (for orchestrators)."
    },
    {
      "id": "replay",
      "usage": "zcl replay --json <attemptDir>",
      "summary": "Best-effort replay of tool.calls.jsonl to reproduce failures (partial support by tool/op)."
    }
  ],
  "errors": [
    {
      "code": "ZCL_E_USAGE",
      "summary": "Invalid CLI usage (missing/invalid flags).",
      "retryable": false
    },
    {
      "code": "ZCL_E_IO",
      "summary": "Filesystem I/O error while writing artifacts.",
      "retryable": true
    },
    {
      "code": "ZCL_E_MISSING_ARTIFACT",
      "summary": "Missing required artifact(s) for the requested operation.",
      "retryable": true
    },
    {
      "code": "ZCL_E_MISSING_EVIDENCE",
      "summary": "Primary evidence is missing/empty (e.g. empty tool.calls.jsonl).",
      "retryable": true
    },
    {
      "code": "ZCL_E_INVALID_JSON",
      "summary": "Invalid JSON in an artifact file.",
      "retryable": false
    },
    {
      "code": "ZCL_E_INVALID_JSONL",
      "summary": "Invalid JSONL stream (bad line or empty line in strict mode).",
      "retryable": false
    },
    {
      "code": "ZCL_E_SCHEMA_UNSUPPORTED",
      "summary": "Unsupported schema version for an artifact/event.",
      "retryable": false
    },
    {
      "code": "ZCL_E_ID_MISMATCH",
      "summary": "IDs in artifacts/events do not match expected attempt/run IDs.",
      "retryable": false
    },
    {
      "code": "ZCL_E_BOUNDS",
      "summary": "Captured payload exceeds size bounds.",
      "retryable": false
    },
    {
      "code": "ZCL_E_CONTRACT",
      "summary": "Artifact/event violates the ZCL contract shape.",
      "retryable": false
    },
    {
      "code": "ZCL_E_CONTAINMENT",
      "summary": "Artifact path escapes attempt/run directory (symlink traversal).",
      "retryable": false
    },
    {
      "code": "ZCL_E_SPAWN",
      "summary": "Failed to spawn or execute a wrapped command in the funnel.",
      "retryable": true
    },
    {
      "code": "ZCL_E_TIMEOUT",
      "summary": "Timed out waiting for a tool operation.",
      "retryable": true
    },
    {
      "code": "ZCL_E_FUNNEL_BYPASS",
      "summary": "Primary evidence missing/empty despite a final outcome being recorded (funnel bypass suspected).",
      "retryable": false
    },
    {
      "code": "ZCL_E_EXPECTATION_FAILED",
      "summary": "Suite expectations did not match feedback.json.",
      "retryable": false
    }
  ]
}
